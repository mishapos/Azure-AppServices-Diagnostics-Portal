!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common")):"function"==typeof define&&define.amd?define("@joelwenzel/ng-flowchart",["exports","@angular/core","@angular/common"],e):e(((t="undefined"!=typeof globalThis?globalThis:t||self).joelwenzel=t.joelwenzel||{},t.joelwenzel["ng-flowchart"]={}),t.ng.core,t.ng.common)}(this,(function(t,e,n){"use strict";function o(t,e){var n,o,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(r){return function(a){return function(r){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,o&&(i=2&r[0]?o.return:r[0]?o.throw||((i=o.return)&&i.call(o),0):o.next)&&!(i=i.call(o,r[1])).done)return i;switch(o=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return s.label++,{value:r[1],done:!1};case 5:s.label++,o=r[1],r=[0];continue;case 7:r=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==r[0]&&2!==r[0])){s=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){s.label=r[1];break}if(6===r[0]&&s.label<i[1]){s.label=i[1],i=r;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(r);break}i[2]&&s.ops.pop(),s.trys.pop();continue}r=e.call(t,s)}catch(t){r=[6,t],o=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,a])}}}Object.create;function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var o,i,r=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(o=r.next()).done;)s.push(o.value)}catch(t){i={error:t}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(i)throw i.error}}return s}function r(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}Object.create;var s=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{p(o.next(t))}catch(t){r(t)}}function a(t){try{p(o.throw(t))}catch(t){r(t)}}function p(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}p((o=o.apply(t,e||[])).next())}))};!function(t){var e=function(){function t(t){this.canvas=t}return t.prototype.toJSON=function(t){return JSON.stringify(this.toObject(),null,t)},t.prototype.toObject=function(){var t;return{root:null===(t=this.canvas.flow.rootStep)||void 0===t?void 0:t.toJSON()}},t.prototype.upload=function(t){return s(this,void 0,void 0,(function(){var e,n;return o(this,(function(o){switch(o.label){case 0:return e="string"==typeof t?JSON.parse(t):t,n=e.root,this.clear(),[4,this.canvas.upload(n)];case 1:return o.sent(),[2]}}))}))},t.prototype.getRoot=function(){return this.canvas.flow.rootStep},t.prototype.getStep=function(t){return this.canvas.flow.steps.find((function(e){return e.id==t}))},t.prototype.render=function(t){this.canvas.reRender(t)},t.prototype.clear=function(){var t;(null===(t=this.canvas.flow)||void 0===t?void 0:t.rootStep)&&(this.canvas.flow.rootStep.destroy(!0,!1),this.canvas.reRender())},t}();t.Flow=e;var n=function(){this.stepGap=40,this.hoverDeadzoneRadius=20,this.isSequential=!1,this.rootPosition="TOP_CENTER",this.centerOnResize=!0,this.zoom={mode:"WHEEL",defaultStep:.1}};t.Options=n}(t.NgFlowchart||(t.NgFlowchart={}));var a="ngflowchart-drop-hover",p="ngflowchart-canvas-content",c="ngflowchart-canvas",h=function(){function t(){this.opacity=1,this.containerWidth=0,this.containerHeight=0,this.containerLeft=0,this.containerTop=0,this.padding=10,this.isLeftFlowing=!1}return Object.defineProperty(t.prototype,"position",{set:function(t){this._position=t,this.isLeftFlowing=t.start[0]>t.end[0],this.containerWidth=Math.abs(t.start[0]-t.end[0])+2*this.padding,this.containerLeft=Math.min(t.start[0],t.end[0])-this.padding,this.containerHeight=Math.abs(t.start[1]-t.end[1]),this.containerTop=t.start[1],this.updatePath()},enumerable:!1,configurable:!0}),t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){this.updatePath()},t.prototype.hideArrow=function(){this.opacity=.2},t.prototype.showArrow=function(){this.opacity=1},t.prototype.updatePath=function(){var t;(null===(t=this.arrow)||void 0===t?void 0:t.nativeElement)&&(this.isLeftFlowing?this.arrow.nativeElement.setAttribute("d","\n        M"+(this.containerWidth-this.padding)+",0 \n        L"+(this.containerWidth-this.padding)+","+this.containerHeight/2+"\n        L"+this.padding+","+this.containerHeight/2+"\n        L"+this.padding+","+(this.containerHeight-4)+"\n      "):this.arrow.nativeElement.setAttribute("d","\n        M"+this.padding+",0 \n        L"+this.padding+","+this.containerHeight/2+"\n        L"+(this.containerWidth-this.padding)+","+this.containerHeight/2+"\n        L"+(this.containerWidth-this.padding)+","+(this.containerHeight-4)+"\n      "))},t}();h.decorators=[{type:e.Component,args:[{selector:"lib-ng-flowchart-arrow",template:'<svg\r\n  xmlns="http://www.w3.org/2000/svg"\r\n  [ngStyle]="{\r\n      height: containerHeight+\'px\',\r\n      width: containerWidth+\'px\',\r\n      left: containerLeft+\'px\',\r\n      top: containerTop+\'px\',\r\n      opacity: opacity\r\n  }"\r\n  class="ngflowchart-arrow"\r\n>\r\n  <defs>\r\n    <marker\r\n      id="arrowhead"\r\n      viewBox="0 0 10 10"\r\n      refX="3"\r\n      refY="5"\r\n      markerWidth="5"\r\n      markerHeight="5"\r\n      orient="auto"\r\n      fill="grey"\r\n    >\r\n      <path d="M 0 0 L 10 5 L 0 10 z" />\r\n    </marker>\r\n  </defs>\r\n  <g id="arrowpath" fill="none" stroke="grey" stroke-width="2" marker-end="url(#arrowhead)">\r\n    <path id="arrow" #arrow />\r\n  </g>\r\n</svg>\r\n',styles:["svg{position:absolute;z-index:0;transition:all .2s}"]}]}],h.ctorParameters=function(){return[]},h.propDecorators={arrow:[{type:e.ViewChild,args:["arrow"]}],position:[{type:e.Input}]};var l=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{p(o.next(t))}catch(t){r(t)}}function a(t){try{p(o.throw(t))}catch(t){r(t)}}function p(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}p((o=o.apply(t,e||[])).next())}))},d=function(){function t(){this.viewInit=new e.EventEmitter,this._currentPosition=[0,0],this._isHidden=!1,this._children=[]}return t.prototype.onMoveStart=function(t){this.canvas.disabled||(this.hideTree(),t.dataTransfer.setData("type","FROM_CANVAS"),t.dataTransfer.setData("id",this.nativeElement.id),this.drop.dragStep={type:this.type,data:this.data,instance:this})},t.prototype.onMoveEnd=function(t){this.showTree()},t.prototype.init=function(t,e,n){this.drop=t,this.viewContainer=e,this.compFactory=n},t.prototype.canDeleteStep=function(){return!0},t.prototype.canDrop=function(t,e){return!0},t.prototype.shouldEvalDropHover=function(t,e){return!0},t.prototype.onUpload=function(t){return l(this,void 0,void 0,(function(){return o(this,(function(t){return[2]}))}))},t.prototype.getDropPositionsForStep=function(t){return["BELOW","LEFT","RIGHT","ABOVE"]},t.prototype.ngOnInit=function(){},t.prototype.ngAfterViewInit=function(){if(!this.nativeElement)throw"Missing canvasContent ViewChild. Be sure to add #canvasContent to your root html element.";this.nativeElement.classList.add("ngflowchart-step-wrapper"),this.nativeElement.setAttribute("draggable","true"),this._initPosition&&this.zsetPosition(this._initPosition),this.nativeElement.id=this.id,this.viewInit.emit()},Object.defineProperty(t.prototype,"id",{get:function(){return null==this._id&&(this._id="s"+Date.now()),this._id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"currentPosition",{get:function(){return this._currentPosition},enumerable:!1,configurable:!0}),t.prototype.addChild=function(t,e){return l(this,void 0,void 0,(function(){var n;return o(this,(function(o){switch(o.label){case 0:return[4,this.canvas.createStep(t)];case 1:return n=o.sent(),this.canvas.addToCanvas(n),(null==e?void 0:e.sibling)?this.zaddChildSibling0(n.instance,null==e?void 0:e.index):this.zaddChild0(n.instance),this.canvas.flow.addStep(n.instance),this.canvas.reRender(),[2,n.instance]}}))}))},t.prototype.destroy=function(t,e){if(void 0===t&&(t=!0),void 0===e&&(e=!0),!e||this.canDeleteStep()){this.canvas.options.callbacks.beforeDeleteStep&&this.canvas.options.callbacks.beforeDeleteStep(this);var n=void 0;return this._parent&&(n=this._parent.removeChild(this)),this.destroy0(n,t),this.canvas.reRender(),this.canvas.options.callbacks.afterDeleteStep&&this.canvas.options.callbacks.afterDeleteStep(this),!0}return!1},t.prototype.removeChild=function(t){if(!this.children)return-1;var e=this.children.findIndex((function(e){return e.id==t.id}));return e>-1&&this.children.splice(e,1),e},t.prototype.setParent=function(t,e){void 0===e&&(e=!1),!this.parent||e?(this._parent=t,!this._parent&&this.arrow&&(this.arrow.destroy(),this.arrow=null)):console.warn("This child already has a parent, use force if you know what you are doing")},t.prototype.clearHoverIcons=function(){this.nativeElement.removeAttribute(a)},t.prototype.showHoverIcon=function(t){this.nativeElement.setAttribute(a,t.toLowerCase())},t.prototype.isRootElement=function(){return!this.parent},t.prototype.hasChildren=function(t){return void 0===t&&(t=1),this.children&&this.children.length>=t},Object.defineProperty(t.prototype,"children",{get:function(){return this._children},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},enumerable:!1,configurable:!0}),t.prototype.getNodeTreeWidth=function(t){var e=this.nativeElement.getBoundingClientRect().width;if(!this.hasChildren())return this.nativeElement.getBoundingClientRect().width;var n=this._children.reduce((function(e,n){return e+n.getNodeTreeWidth(t)}),0);return n+=t*(this._children.length-1),Math.max(e,n)},t.prototype.isHidden=function(){return this._isHidden},t.prototype.getCurrentRect=function(t){var e=this.nativeElement.getBoundingClientRect();return{bottom:this._currentPosition[1]+e.height+((null==t?void 0:t.top)||0),left:this._currentPosition[0]+((null==t?void 0:t.left)||0),height:e.height,width:e.width,right:this._currentPosition[0]+e.width+((null==t?void 0:t.left)||0),top:this._currentPosition[1]+((null==t?void 0:t.top)||0)}},t.prototype.toJSON=function(){return{id:this.id,type:this.type,data:this.data,children:this.hasChildren()?this._children.map((function(t){return t.toJSON()})):[]}},Object.defineProperty(t.prototype,"nativeElement",{get:function(){var t;return null===(t=this.view)||void 0===t?void 0:t.nativeElement},enumerable:!1,configurable:!0}),t.prototype.setId=function(t){this._id=t},t.prototype.zsetPosition=function(t,e){if(void 0===e&&(e=!1),!this.view)return console.warn("Trying to set position before view init"),void(this._initPosition=r(t));var n=Math.max(t[0]-(e?this.nativeElement.offsetWidth/2:0),0),o=Math.max(t[1]-(e?this.nativeElement.offsetHeight/2:0),0);this.nativeElement.style.left=n+"px",this.nativeElement.style.top=o+"px",this._currentPosition=[n,o]},t.prototype.zaddChild0=function(t){var e=null;if(t._parent&&(e=t._parent.removeChild(t)),this.hasChildren())if(t.hasChildren()){var n=t.findLastSingleChild();if(!n)return t._parent.zaddChildSibling0(t,e),console.error("Invalid move. A node cannot have multiple parents"),!1;n.setChildren(this._children.slice())}else t.setChildren(this._children.slice());return this.setChildren([t]),!0},t.prototype.zaddChildSibling0=function(t,e){t._parent&&t._parent.removeChild(t),this.children||(this._children=[]),null==e?this.children.push(t):this.children.splice(e,0,t),t.setParent(this,!0)},t.prototype.zdrawArrow=function(t,e){this.arrow||this.createArrow(),this.arrow.instance.position={start:t,end:e}},t.prototype.destroy0=function(t,e){if(void 0===e&&(e=!0),this.compRef.destroy(),this.canvas.flow.removeStep(this),this.isRootElement()&&(this.canvas.flow.rootStep=null),this.hasChildren()){if(this.isRootElement()&&!e){var n=this._children[0];if(this.canvas.flow.rootStep=n,n.setParent(null,!0),this.hasChildren(2))for(var o=1;o<this._children.length;o++){(r=this._children[o]).setParent(n,!0),n._children.push(r)}}var i=this._children.length;for(o=0;o<i;o++){var r=this._children[o];e?r.destroy0(null,!0):this._parent&&(this._parent._children.splice(o+t,0,r),r.setParent(this._parent,!0))}this.setChildren([])}this._parent=null},t.prototype.createArrow=function(){var t=this.compFactory.resolveComponentFactory(h);this.arrow=this.viewContainer.createComponent(t),this.nativeElement.parentElement.appendChild(this.arrow.location.nativeElement)},t.prototype.hideTree=function(){this._isHidden=!0,this.nativeElement.style.opacity=".4",this.arrow&&this.arrow.instance.hideArrow(),this.hasChildren()&&this._children.forEach((function(t){t.hideTree()}))},t.prototype.showTree=function(){this._isHidden=!1,this.arrow&&this.arrow.instance.showArrow(),this.nativeElement.style.opacity="1",this.hasChildren()&&this._children.forEach((function(t){t.showTree()}))},t.prototype.findLastSingleChild=function(){return this.hasChildren(2)?null:this.hasChildren()?this._children[0].findLastSingleChild():this},t.prototype.setChildren=function(t){var e=this;this._children=t,this.children.forEach((function(t){t.setParent(e,!0)}))},t}();d.decorators=[{type:e.Component,args:[{selector:"ng-flowchart-step",template:'<div #canvasContent [id]="id">\r\n  <ng-container\r\n    *ngTemplateOutlet="\r\n      contentTemplate;\r\n      context: {\r\n        $implicit: {\r\n          data: data,\r\n          id: id\r\n        }\r\n      }\r\n    "\r\n  >\r\n  </ng-container>\r\n</div>\r\n',encapsulation:e.ViewEncapsulation.None,styles:['.ngflowchart-canvas{overflow:auto;display:flex}.ngflowchart-canvas-content.scaling .ngflowchart-step-wrapper,.ngflowchart-canvas-content.scaling svg{transition:none!important}.ngflowchart-canvas-content{position:relative;min-height:100%;min-width:100%;flex:1 1 100%}.ngflowchart-step-wrapper{height:auto;width:auto;position:absolute;box-sizing:border-box;transition:all .2s;cursor:-webkit-grab;cursor:grab}.ngflowchart-step-wrapper[ngflowchart-drop-hover]:before{content:"";width:12px;height:12px;border-radius:100%;position:absolute;z-index:1;background:#8b0000}.ngflowchart-step-wrapper[ngflowchart-drop-hover]:after{content:"";width:20px;height:20px;border-radius:100%;position:absolute;z-index:0;background:#c07b7b;-webkit-animation:backgroundOpacity 2s linear infinite;animation:backgroundOpacity 2s linear infinite}.ngflowchart-step-wrapper[ngflowchart-drop-hover=above]:after,.ngflowchart-step-wrapper[ngflowchart-drop-hover=above]:before{top:0;right:50%;transform:translate(50%,-50%)}.ngflowchart-step-wrapper[ngflowchart-drop-hover=below]:after,.ngflowchart-step-wrapper[ngflowchart-drop-hover=below]:before{bottom:0;right:50%;transform:translate(50%,50%)}.ngflowchart-step-wrapper[ngflowchart-drop-hover=right]:after,.ngflowchart-step-wrapper[ngflowchart-drop-hover=right]:before{right:0;top:50%;transform:translate(50%,-50%)}.ngflowchart-step-wrapper[ngflowchart-drop-hover=left]:after,.ngflowchart-step-wrapper[ngflowchart-drop-hover=left]:before{left:0;top:50%;transform:translate(-50%,-50%)}@-webkit-keyframes wiggle{0%{transform:translateX(0);border:2px solid red}25%{transform:translateX(-10px)}50%{transform:translateX(0)}75%{transform:translateX(10px)}to{transform:translateX(0);border:2px solid red}}@keyframes wiggle{0%{transform:translateX(0);border:2px solid red}25%{transform:translateX(-10px)}50%{transform:translateX(0)}75%{transform:translateX(10px)}to{transform:translateX(0);border:2px solid red}}@-webkit-keyframes backgroundOpacity{0%{opacity:.8}50%{opacity:.3}to{opacity:.8}}@keyframes backgroundOpacity{0%{opacity:.8}50%{opacity:.3}to{opacity:.8}}']}]}],d.ctorParameters=function(){return[]},d.propDecorators={onMoveStart:[{type:e.HostListener,args:["dragstart",["$event"]]}],onMoveEnd:[{type:e.HostListener,args:["dragend",["$event"]]}],view:[{type:e.ViewChild,args:["canvasContent"]}],data:[{type:e.Input}],type:[{type:e.Input}],canvas:[{type:e.Input}],compRef:[{type:e.Input}],viewInit:[{type:e.Output}],contentTemplate:[{type:e.Input}]};var u=function(){function e(){this._callbacks={},this._options=new t.NgFlowchart.Options}return e.prototype.setOptions=function(t){this._options=this.sanitizeOptions(t)},e.prototype.setCallbacks=function(t){this._callbacks=t},Object.defineProperty(e.prototype,"options",{get:function(){return this._options},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"callbacks",{get:function(){return this._callbacks},enumerable:!1,configurable:!0}),e.prototype.sanitizeOptions=function(e){var n=new t.NgFlowchart.Options;return(e=Object.assign(Object.assign({},n),e)).stepGap=Math.max(e.stepGap,20)||40,e.hoverDeadzoneRadius=Math.max(e.hoverDeadzoneRadius,0)||20,e},e}();u.decorators=[{type:e.Injectable}],u.ctorParameters=function(){return[]};var f=function(){function t(t){this.options=t,this.scale=1,this.scaleDebounceTimer=null}return t.prototype.init=function(t){this.viewContainer=t},t.prototype.renderRoot=function(t,e){this.getCanvasContentElement().appendChild(t.location.nativeElement),this.setRootPosition(t.instance,e)},t.prototype.renderNonRoot=function(t,e){this.getCanvasContentElement().appendChild(t.location.nativeElement)},t.prototype.updatePosition=function(t,e){var n=this,o=this.getRelativeXY(e);o=o.map((function(t){return t/n.scale})),t.zsetPosition(o,!0)},t.prototype.getStepGap=function(){return this.options.options.stepGap},t.prototype.renderChildTree=function(t,e,n){var o=this;if(t.hasChildren()){var i=e.bottom-n.top*this.scale+this.getStepGap(),r=e.width/this.scale,s=e.left-n.left+r/2,a={},p=0;t.children.forEach((function(t){var e=t.getNodeTreeWidth(o.getStepGap());e/=o.scale,a[t.nativeElement.id]=e,p+=e})),p+=(t.children.length-1)*this.getStepGap();var c=s-p/2;c=Math.max(0,c),t.children.forEach((function(t){var r=a[t.nativeElement.id],p=c+r/2-t.nativeElement.offsetWidth/2;t.zsetPosition([p,i]);var h=t.getCurrentRect(n),l=h.width/o.scale;t.zdrawArrow([s,e.bottom-n.top*o.scale],[h.left+l/2-n.left,h.top-n.top]),o.renderChildTree(t,h,n),c+=r+o.getStepGap()}))}},t.prototype.render=function(t,e,n){var o,i,r;if(void 0===n&&(n=!1),t.hasRoot()){(null===(i=this.options.callbacks)||void 0===i?void 0:i.beforeRender)&&this.options.callbacks.beforeRender();var s=this.getCanvasContentElement().getBoundingClientRect();e&&this.setRootPosition(t.rootStep,null),this.renderChildTree(t.rootStep,t.rootStep.getCurrentRect(s),s),n||"DISABLED"!==this.options.options.zoom.mode||this.adjustDimensions(t,s),(null===(r=this.options.callbacks)||void 0===r?void 0:r.afterRender)&&this.options.callbacks.afterRender()}else"DISABLED"===this.options.options.zoom.mode&&(this.resetAdjustDimensions(),(null===(o=this.options.callbacks)||void 0===o?void 0:o.afterRender)&&this.options.callbacks.afterRender())},t.prototype.resetAdjustDimensions=function(){if(this.viewContainer){var t=this.getCanvasContentElement();t.style.minWidth=null,t.style.minHeight=null}},t.prototype.findDropLocationForHover=function(t,e,n){if(!e.shouldEvalDropHover(t,n))return"deadzone";var o=e.nativeElement.getBoundingClientRect(),i=o.bottom-o.height/2,r=o.left+o.width/2,s=t[1]-i,a=t[0]-r,p=Math.abs(s),c=Math.abs(a),h=Math.sqrt(p*p+c*c),l=null;return h<(o.height+o.width)/2&&(h<this.options.options.hoverDeadzoneRadius&&(l="deadzone"),p>c?l={step:e,position:s>0?"BELOW":"ABOVE",proximity:p}:this.options.options.isSequential||e.isRootElement()||(l={step:e,position:a>0?"RIGHT":"LEFT",proximity:c})),l&&"deadzone"!==l&&(e.getDropPositionsForStep(n).includes(l.position)||(l=null)),l},t.prototype.adjustDimensions=function(t,e){var n=0,o=0;t.steps.forEach((function(t){var i=t.getCurrentRect(e);n=Math.max(i.right,n),o=Math.max(i.bottom,o)}));var i=100,r=e.width-(n-e.left);if(r<i){var s=i;r<0&&(s+=Math.abs(r)),this.getCanvasContentElement().style.minWidth=e.width+s+"px",this.options.options.centerOnResize&&this.render(t,!0,!0)}else if(r>i){var a=this.getTotalTreeWidth(t);this.isNestedCanvas()?(this.getCanvasContentElement().style.minWidth=a+i+"px",this.options.options.centerOnResize&&this.render(t,!0,!0)):this.getCanvasContentElement().style.minWidth&&(this.getCanvasContentElement().style.minWidth=null,this.options.options.centerOnResize&&this.render(t,!0,!0))}var p=e.height-(o-e.top);if(p<50){var c=50;p<0&&(c+=Math.abs(p)),this.getCanvasContentElement().style.minHeight=e.height+c+"px"}else if(p>50)if(this.isNestedCanvas()){var h=p-50;this.getCanvasContentElement().style.minHeight=e.height-h+"px"}else this.getCanvasContentElement().style.minHeight&&(this.getCanvasContentElement().style.minHeight=null)},t.prototype.getTotalTreeWidth=function(t){var e=this,n=0,o=t.rootStep.getCurrentRect().width/this.scale;return t.rootStep.children.forEach((function(t){var o=t.getNodeTreeWidth(e.getStepGap());n+=o/e.scale})),n+=(t.rootStep.children.length-1)*this.getStepGap(),Math.max(n,o)},t.prototype.findBestMatchForSteps=function(t,e,n){for(var o=[e.clientX,e.clientY],i=null,r=0;r<n.length;r++){var s=n[r];if(!s.isHidden()){var a=this.findDropLocationForHover(o,s,t);if(a){if("deadzone"==a){i=null;break}(null==i||i.proximity>a.proximity)&&(i=a)}}}return i},t.prototype.findAndShowClosestDrop=function(t,e,n){if(n&&0!=n.length){var o=this.findBestMatchForSteps(t,e,n);if(n.forEach((function(t){null!=o&&t.nativeElement.id===o.step.nativeElement.id||t.clearHoverIcons()})),o)return o.step.showHoverIcon(o.position),{step:o.step,position:o.position}}},t.prototype.showSnaps=function(t){},t.prototype.clearAllSnapIndicators=function(t){t.forEach((function(t){return t.clearHoverIcons()}))},t.prototype.setRootPosition=function(t,e){if(e)switch(this.options.options.rootPosition){case"CENTER":var n=this.getCanvasCenterPosition();return void t.zsetPosition(n,!0);case"TOP_CENTER":i=this.getCanvasTopCenterPosition(t.nativeElement);return void t.zsetPosition(i,!0);default:var o=this.getRelativeXY(e);return void t.zsetPosition(o,!0)}else{var i=this.getCanvasTopCenterPosition(t.nativeElement);t.zsetPosition(i,!0)}},t.prototype.getRelativeXY=function(t){var e=this.getCanvasContentElement().getBoundingClientRect();return[t.clientX-e.left,t.clientY-e.top]},t.prototype.getCanvasTopCenterPosition=function(t){var e=this.getCanvasContentElement().getBoundingClientRect(),n=t.getBoundingClientRect().height/2+this.options.options.stepGap,o=100*(1-this.scale);return[e.width/(2*this.scale),n+o]},t.prototype.getCanvasCenterPosition=function(){var t=this.getCanvasContentElement().getBoundingClientRect();return[t.width/2,t.height/2]},t.prototype.getCanvasContentElement=function(){return this.viewContainer.element.nativeElement.getElementsByClassName(p).item(0)},t.prototype.isNestedCanvas=function(){if(this.viewContainer){var t=this.viewContainer.element.nativeElement.parentElement;if(t)return t.classList.contains("ngflowchart-step-wrapper")}return!1},t.prototype.resetScale=function(t){this.setScale(t,1)},t.prototype.scaleUp=function(t,e){var n=this.scale+(this.scale*e||this.options.options.zoom.defaultStep);this.setScale(t,n)},t.prototype.scaleDown=function(t,e){var n=this.scale-(this.scale*e||this.options.options.zoom.defaultStep);this.setScale(t,n)},t.prototype.setScale=function(t,e){var n,o=1/e*100+"%",i=this.getCanvasContentElement();i.style.transform="scale("+e+")",i.style.minHeight=o,i.style.minWidth=o,i.style.transformOrigin="top left",i.classList.add("scaling"),this.scale=e,this.render(t,!0),(null===(n=this.options.callbacks)||void 0===n?void 0:n.afterScale)&&this.options.callbacks.afterScale(this.scale),this.scaleDebounceTimer&&clearTimeout(this.scaleDebounceTimer),this.scaleDebounceTimer=setTimeout((function(){i.classList.remove("scaling")}),300)},t}();f.decorators=[{type:e.Injectable}],f.ctorParameters=function(){return[{type:u}]};var v=function(){function t(){}return t.prototype.setDragStep=function(t){this.dragStep=t},t.prototype.getDragStep=function(){return this.dragStep},t}();v.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new v},token:v,providedIn:"root"}),v.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],v.ctorParameters=function(){return[]};var g=function(){function t(){this.registry=new Map}return t.prototype.registerStep=function(t,e){this.registry.set(t,e)},t.prototype.getStepImpl=function(t){return this.registry.get(t)},t}();g.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new g},token:g,providedIn:"root"}),g.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],g.ctorParameters=function(){return[]};var y=function(){function t(t,e){this.componentFactoryResolver=t,this.registry=e}return t.prototype.init=function(t){this.viewContainer=t},t.prototype.createFromRegistry=function(t,n,o,i){var r,s=this.registry.getStepImpl(n);if(!(s instanceof e.TemplateRef||s instanceof e.Type))throw"Invalid registry implementation found for type "+n;return(r=this.create({template:s,type:n,data:o},i)).instance.setId(t),r},t.prototype.create=function(t,n){var o;if(t.template instanceof e.TemplateRef){var i=this.componentFactoryResolver.resolveComponentFactory(d);(o=this.viewContainer.createComponent(i)).instance.contentTemplate=t.template}else{i=this.componentFactoryResolver.resolveComponentFactory(t.template);o=this.viewContainer.createComponent(i)}return o.instance.data=JSON.parse(JSON.stringify(t.data)),o.instance.type=t.type,o.instance.canvas=n,o.instance.compRef=o,o.instance.init(o.injector.get(v),o.injector.get(e.ViewContainerRef),o.injector.get(e.ComponentFactoryResolver)),o},t}();y.decorators=[{type:e.Injectable}],y.ctorParameters=function(){return[{type:e.ComponentFactoryResolver},{type:g}]};var m=this&&this.__awaiter||function(t,e,n,o){return new(n||(n=Promise))((function(i,r){function s(t){try{p(o.next(t))}catch(t){r(t)}}function a(t){try{p(o.throw(t))}catch(t){r(t)}}function p(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}p((o=o.apply(t,e||[])).next())}))},w=function(){function t(){this._steps=[]}return t.prototype.hasRoot=function(){return!!this.rootStep},t.prototype.addStep=function(t){this._steps.push(t)},t.prototype.removeStep=function(t){var e=this._steps.findIndex((function(e){return e.id==t.id}));e>=0&&this._steps.splice(e,1)},Object.defineProperty(t.prototype,"steps",{get:function(){return this._steps},enumerable:!1,configurable:!0}),t}(),b=function(){function t(t,e,n,o){this.drag=t,this.options=e,this.renderer=n,this.stepmanager=o,this.isDragging=!1,this.flow=new w,this._disabled=!1,this.noParentError={code:"NO_PARENT",message:"Step was not dropped under a parent and is not the root node"}}return Object.defineProperty(t.prototype,"disabled",{get:function(){return this._disabled},enumerable:!1,configurable:!0}),t.prototype.init=function(t){this.viewContainer=t,this.renderer.init(t),this.stepmanager.init(t);var e=this.stepmanager.create({template:d,type:"",data:null},this),n=this.viewContainer.indexOf(e.hostView);this.viewContainer.remove(n)},t.prototype.moveStep=function(t,e){var n;this.renderer.clearAllSnapIndicators(this.flow.steps);var o=this.flow.steps.find((function(t){return t.nativeElement.id===e})),i={};if(o)if(o.canDrop(this.currentDropTarget,i)){if(o.isRootElement())this.renderer.updatePosition(o,t),this.renderer.render(this.flow);else if(this.currentDropTarget){var r=this.addStepToFlow(o,this.currentDropTarget,!0);this.renderer.render(this.flow,r.prettyRender)}else this.moveError(o,this.noParentError);(null===(n=this.options.callbacks)||void 0===n?void 0:n.onDropStep)&&(this.currentDropTarget||o.isRootElement())&&this.options.callbacks.onDropStep({isMove:!0,step:o,parent:o.parent})}else this.moveError(o,i)},t.prototype.onDrop=function(t){var e;return m(this,void 0,void 0,(function(){var n,i,r,s;return o(this,(function(o){switch(o.label){case 0:return this.renderer.clearAllSnapIndicators(this.flow.steps),this.flow.hasRoot()&&!this.currentDropTarget?(this.dropError(this.noParentError),[2]):[4,this.createStep(this.drag.dragStep)];case 1:return n=o.sent(),i=this.currentDropTarget||null,r={},n.instance.canDrop(i,r)?(this.flow.hasRoot()?(i.step.isRootElement()&&"ABOVE"===i.position&&this.renderer.renderRoot(n,t),this.addChildStep(n,i)):(this.renderer.renderRoot(n,t),this.setRoot(n.instance)),(null===(e=this.options.callbacks)||void 0===e?void 0:e.onDropStep)&&this.options.callbacks.onDropStep({step:n.instance,isMove:!1,parent:n.instance.parent})):(s=this.viewContainer.indexOf(n.hostView),this.viewContainer.remove(s),this.dropError(r)),[2]}}))}))},t.prototype.onDragStart=function(t){this.isDragging=!0,this.currentDropTarget=this.renderer.findAndShowClosestDrop(this.drag.dragStep,t,this.flow.steps)},t.prototype.createStepFromType=function(t,e,n){var i=this,r=this.stepmanager.createFromRegistry(t,e,n,this);return new Promise((function(t){var e=r.instance.viewInit.subscribe((function(){return m(i,void 0,void 0,(function(){return o(this,(function(o){return e.unsubscribe(),setTimeout((function(){r.instance.onUpload(n)})),t(r),[2]}))}))}))}))},t.prototype.createStep=function(t){var e;return e=this.stepmanager.create(t,this),new Promise((function(t){var n=e.instance.viewInit.subscribe((function(){n.unsubscribe(),t(e)}),(function(t){return console.error(t)}))}))},t.prototype.resetScale=function(){"DISABLED"!==this.options.options.zoom.mode&&this.renderer.resetScale(this.flow)},t.prototype.scaleUp=function(t){"DISABLED"!==this.options.options.zoom.mode&&this.renderer.scaleUp(this.flow,t)},t.prototype.scaleDown=function(t){"DISABLED"!==this.options.options.zoom.mode&&this.renderer.scaleDown(this.flow,t)},t.prototype.setScale=function(t){"DISABLED"!==this.options.options.zoom.mode&&this.renderer.setScale(this.flow,t)},t.prototype.addChildStep=function(t,e){this.addToCanvas(t);var n=this.addStepToFlow(t.instance,e);this.renderer.render(this.flow,n.prettyRender)},t.prototype.addToCanvas=function(t){this.renderer.renderNonRoot(t)},t.prototype.reRender=function(t){this.renderer.render(this.flow,t)},t.prototype.upload=function(t){return m(this,void 0,void 0,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this.uploadNode(t)];case 1:return e.sent(),this.reRender(!0),[2]}}))}))},t.prototype.uploadNode=function(t,e){return m(this,void 0,void 0,(function(){var n,i,r,s;return o(this,(function(o){switch(o.label){case 0:return t?[4,this.createStepFromType(t.id,t.type,t.data)]:[2];case 1:n=o.sent(),e?(this.renderer.renderNonRoot(n),this.flow.addStep(n.instance)):(this.setRoot(n.instance),this.renderer.renderRoot(n,null)),i=0,o.label=2;case 2:return i<t.children.length?(r=t.children[i],[4,this.uploadNode(r,n.instance)]):[3,5];case 3:s=o.sent(),n.instance.children.push(s),s.setParent(n.instance,!0),o.label=4;case 4:return i++,[3,2];case 5:return[2,n.instance]}}))}))},t.prototype.setRoot=function(t,e){if(void 0===e&&(e=!0),this.flow.hasRoot()){if(!e)return void console.warn("Already have a root and force is false");var n=this.flow.rootStep;this.flow.rootStep=t,t.zaddChild0(n)}else this.flow.rootStep=t;this.flow.addStep(t)},t.prototype.addStepToFlow=function(t,e,n){void 0===n&&(n=!1);var o={added:!1,prettyRender:!1};switch(e.position){case"ABOVE":o=this.placeStepAbove(t,e.step);break;case"BELOW":o=this.placeStepBelow(t,e.step),console.log(o,r(e.step.children));break;case"LEFT":o=this.placeStepAdjacent(t,e.step,!0);break;case"RIGHT":o=this.placeStepAdjacent(t,e.step,!1)}return!n&&o.added&&this.flow.addStep(t),o},t.prototype.placeStepBelow=function(t,e){return{added:e.zaddChild0(t),prettyRender:!1}},t.prototype.placeStepAdjacent=function(t,e,n){if(void 0===n&&(n=!0),!e.parent)return console.warn("Parallel actions must have a common parent"),{added:!1,prettyRender:!1};var o=e.parent.children.findIndex((function(t){return t.nativeElement.id==e.nativeElement.id}));return e.parent.zaddChildSibling0(t,o+(n?0:1)),{added:!0,prettyRender:!1}},t.prototype.placeStepAbove=function(t,e){var n,o=!1,i=e.parent;if(i){i.removeChild(e);t.zaddChild0(e),i.zaddChild0(t)}else null===(n=t.parent)||void 0===n||n.removeChild(t),t.setParent(null,!0),e.removeChild(t),this.setRoot(t),o=!0;return{added:!0,prettyRender:o}},t.prototype.dropError=function(t){var e,n,o,i;if(null===(e=this.options.callbacks)||void 0===e?void 0:e.onDropError){var r="BELOW"!==(null===(n=this.currentDropTarget)||void 0===n?void 0:n.position)?null===(o=this.currentDropTarget)||void 0===o?void 0:o.step.parent:null===(i=this.currentDropTarget)||void 0===i?void 0:i.step;this.options.callbacks.onDropError({step:this.drag.dragStep,parent:r||null,error:t})}},t.prototype.moveError=function(t,e){var n,o,i,r;if(null===(n=this.options.callbacks)||void 0===n?void 0:n.onMoveError){var s="BELOW"!==(null===(o=this.currentDropTarget)||void 0===o?void 0:o.position)?null===(i=this.currentDropTarget)||void 0===i?void 0:i.step.parent:null===(r=this.currentDropTarget)||void 0===r?void 0:r.step;this.options.callbacks.onMoveError({step:{instance:t,type:t.type,data:t.data},parent:s,error:e})}},t}();b.decorators=[{type:e.Injectable}],b.ctorParameters=function(){return[{type:v},{type:u},{type:f},{type:y}]};var C=function(){function e(t,e,n,o){this.canvasEle=t,this.viewContainer=e,this.canvas=n,this.optionService=o,this._disabled=!1,this._id=null,this.canvasEle.nativeElement.classList.add(c),this.canvasContent=this.createCanvasContent(this.viewContainer),this._id=this.canvasContent.id}return e.prototype.onDrop=function(t){var e;if(!this._disabled){var n=null===(e=t.target.closest(".ngflowchart-canvas-content"))||void 0===e?void 0:e.id;if(this._id===n)"FROM_CANVAS"==t.dataTransfer.getData("type")?this.canvas.moveStep(t,t.dataTransfer.getData("id")):this.canvas.onDrop(t)}},e.prototype.onDragOver=function(t){t.preventDefault(),this._disabled||this.canvas.onDragStart(t)},e.prototype.onResize=function(t){this._options.centerOnResize&&this.canvas.reRender(!0)},e.prototype.onZoom=function(t){"WHEEL"===this._options.zoom.mode&&this.adjustWheelScale(t)},Object.defineProperty(e.prototype,"callbacks",{set:function(t){this.optionService.setCallbacks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"options",{get:function(){return this._options},set:function(t){this.optionService.setOptions(t),this._options=this.optionService.options,this.canvas.reRender()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disabled",{get:function(){return this._disabled},set:function(t){this._disabled=!1!==t,this.canvas&&(this.canvas._disabled=this._disabled)},enumerable:!1,configurable:!0}),e.prototype.ngOnInit=function(){this.canvas.init(this.viewContainer),this._options||(this.options=new t.NgFlowchart.Options),this.canvas._disabled=this._disabled},e.prototype.ngAfterViewInit=function(){},e.prototype.ngOnDestroy=function(){for(var t=0;t<this.viewContainer.length;t++)this.viewContainer.remove(t);this.canvasEle.nativeElement.remove(),this.viewContainer.element.nativeElement.remove(),this.viewContainer=void 0},e.prototype.createCanvasContent=function(t){var e="c"+Date.now(),n=t.element.nativeElement,o=document.createElement("div");return o.id=e,o.classList.add(p),n.appendChild(o),o},e.prototype.getFlow=function(){return new t.NgFlowchart.Flow(this.canvas)},e.prototype.scaleDown=function(){this.canvas.scaleDown()},e.prototype.scaleUp=function(){this.canvas.scaleUp()},e.prototype.setScale=function(t){var e=Math.max(0,t);this.canvas.setScale(e)},e.prototype.adjustWheelScale=function(t){this.canvas.flow.hasRoot()&&(t.preventDefault(),t.deltaY>0?this.scaleDown():t.deltaY<0&&this.scaleUp())},e}();C.decorators=[{type:e.Directive,args:[{selector:"[ngFlowchartCanvas]",providers:[b,y,u,f]}]}],C.ctorParameters=function(){return[{type:e.ElementRef},{type:e.ViewContainerRef},{type:b},{type:u}]},C.propDecorators={onDrop:[{type:e.HostListener,args:["drop",["$event"]]}],onDragOver:[{type:e.HostListener,args:["dragover",["$event"]]}],onResize:[{type:e.HostListener,args:["window:resize",["$event"]]}],onZoom:[{type:e.HostListener,args:["wheel",["$event"]]}],callbacks:[{type:e.Input,args:["ngFlowchartCallbacks"]}],options:[{type:e.Input,args:["ngFlowchartOptions"]}],disabled:[{type:e.Input,args:["disabled"]},{type:e.HostBinding,args:["attr.disabled"]}]};var S=function(){function t(t,e){this.element=t,this.data=e,this.element.nativeElement.setAttribute("draggable","true")}return t.prototype.onDragStart=function(t){this.data.setDragStep(this.flowStep),t.dataTransfer.setData("type","FROM_PALETTE")},t.prototype.onDragEnd=function(t){this.data.setDragStep(null)},t.prototype.ngAfterViewInit=function(){},t}();S.decorators=[{type:e.Directive,args:[{selector:"[ngFlowchartStep]"}]}],S.ctorParameters=function(){return[{type:e.ElementRef},{type:v}]},S.propDecorators={onDragStart:[{type:e.HostListener,args:["dragstart",["$event"]]}],onDragEnd:[{type:e.HostListener,args:["dragend",["$event"]]}],flowStep:[{type:e.Input,args:["ngFlowchartStep"]}]};var E=function(){};E.decorators=[{type:e.NgModule,args:[{declarations:[C,S,d,h],imports:[n.CommonModule],exports:[C,S,d,h],entryComponents:[d,h]}]}],t.NgFlowchartArrowComponent=h,t.NgFlowchartCanvasDirective=C,t.NgFlowchartModule=E,t.NgFlowchartStepComponent=d,t.NgFlowchartStepDirective=S,t.NgFlowchartStepRegistry=g,t.OptionsService=u,t.ɵa=b,t.ɵb=v,t.ɵc=f,t.ɵd=y,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=joelwenzel-ng-flowchart.umd.min.js.map